var ExtensionFramework=function(e){"use strict";const t={Boolean:"Boolean",Button:"button",Command:"command",Conditional:"conditional",Event:"event",Hat:"hat",Loop:"loop",Reporter:"reporter"},r={Angle:"angle",Boolean:"Boolean",Color:"color",Number:"number",String:"string",Matrix:"matrix",Note:"note",Image:"image",Custom:"custom"},n={BackgroundLayer:"background",VideoLayer:"video",PenLayer:"pen",SpriteLayer:"sprite"},o=[n.VideoLayer,n.SpriteLayer,n.BackgroundLayer,n.PenLayer],i={"Аҧсшәа":"ab","العربية":"ar","አማርኛ":"am",Azeri:"az",Bahasa_Indonesia:"id","Беларуская":"be","Български":"bg","Català":"ca","Česky":"cs",Cymraeg:"cy",Dansk:"da",Deutsch:"de",Eesti:"et","Ελληνικά":"el",English:"en","Español":"es","Español_Latinoamericano":"es-419",Euskara:"eu","فارسی":"fa","Français":"fr",Gaeilge:"ga","Gàidhlig":"gd",Galego:"gl","한국어":"ko","עִבְרִית":"he",Hrvatski:"hr",isiZulu:"zu","Íslenska":"is",Italiano:"it","ქართული_ენა":"ka",Kiswahili:"sw","Kreyòl_ayisyen":"ht","کوردیی_ناوەندی":"ckb","Latviešu":"lv","Lietuvių":"lt",Magyar:"hu","Māori":"mi",Nederlands:"nl","日本語":"ja","にほんご":"ja-Hira","Norsk_Bokmål":"nb",Norsk_Nynorsk:"nn","Oʻzbekcha":"uz","ไทย":"th","ភាសាខ្មែរ":"km",Polski:"pl","Português":"pt","Português_Brasileiro":"pt-br",Rapa_Nui:"rap","Română":"ro","Русский":"ru","Српски":"sr","Slovenčina":"sk","Slovenščina":"sl",Suomi:"fi",Svenska:"sv","Tiếng_Việt":"vi","Türkçe":"tr","Українська":"uk","简体中文":"zh-cn","繁體中文":"zh-tw"},a=Object.keys(i);function s(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r}function c(e,t,r,n,o,i){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var s,c=n.kind,l="getter"===c?"get":"setter"===c?"set":"value",u=e?n.static?e:e.prototype:null,d=u?Object.getOwnPropertyDescriptor(u,n.name):{},m=!1,p=r.length-1;p>=0;p--){var h={};for(var g in n)h[g]="access"===g?{}:n[g];for(var g in n.access)h.access[g]=n.access[g];h.addInitializer=function(e){if(m)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(e||null))};var y=(0,r[p])("accessor"===c?{get:d.get,set:d.set}:d[l],h);if("accessor"===c){if(void 0===y)continue;if(null===y||"object"!=typeof y)throw new TypeError("Object expected");(s=a(y.get))&&(d.get=s),(s=a(y.set))&&(d.set=s),(s=a(y.init))&&o.unshift(s)}else(s=a(y))&&("field"===c?o.unshift(s):d[l]=s)}u&&Object.defineProperty(u,n.name,d),m=!0}function l(e,t,r){for(var n=arguments.length>2,o=0;o<t.length;o++)r=n?t[o].call(e,r):t[o].call(e);return n?r:void 0}function u(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;function d(e){return u(this,void 0,void 0,(function*(){let t;return yield new Promise((r=>t=setTimeout((()=>{clearTimeout(t),r()}),e)))}))}function m(e){return u(this,arguments,void 0,(function*(e,t=100){let r,n=e();for(;!n;)yield new Promise((e=>{clearTimeout(r),r=setTimeout(e,t)})),n=e();return clearTimeout(r),n}))}const p=e=>"string"==typeof e||e instanceof String,h=e=>"[object Function]"===Object.prototype.toString.call(e)||"function"==typeof e||e instanceof Function,g=e=>e!==Object(e),y=e=>e,f=e=>u(void 0,void 0,void 0,(function*(){const t=new Promise(((t,r)=>{const n=document.createElement("script");n.onload=t,n.onerror=r,n.async=!0,n.src=e,document.body.appendChild(n)}));yield t})),v=(e,t,...r)=>e.call(t,...r),b=(e,t,r)=>(e[t]=r,e),w=(...e)=>{const{size:t}=e.reduce(((e,{length:t})=>e.add(t)),new Set);if(1!==t)throw new Error("Zip failed because collections weren't equal length")},E=e=>{const t=e>>24&255;return{r:e>>16&255,g:e>>8&255,b:255&e,a:t>0?t:255}};const x=e=>{e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,((e,t,r,n)=>t+t+r+r+n+n));const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},k=e=>{if("node"!==("undefined"==typeof window?"node":"browser"))return null;const t=`Bundle Time Event: ${e}`,r=()=>{var e;return null!==(e=global[t])&&void 0!==e||(global[t]={}),global[t]};return{registerCallback:e=>{const n=Symbol(t);return r()[n]=e,()=>{var e;return null===(e=r())||void 0===e||delete e[n]}},fire:e=>{var t,n;const o=Object.getOwnPropertySymbols(r());for(const i of o)null===(n=(t=r())[i])||void 0===n||n.call(t,e,(()=>{var e;return null===(e=r())||void 0===e||delete e[i]}))}}},T=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),O="OPEN_UI_FROM_EXTENSION",S="REGISTER_BUTTON_CALLBACK_FROM_EXTENSION",I={runtimeKey:"prgDropdownCustomization",runtimeProperties:{stateKey:"state",entryKey:"entry",updateMethodKey:"update"},state:{open:"open",init:"init",update:"update",close:"close"}},C="blockID",R=(e,t)=>e.emit(O,t),A=(e,t,r)=>{e.emit(S,t),e.on(t,r)};class _{constructor(e){this.root=e}get(...e){return`var(--${this.root}-${e.join("-")})`}primary(...e){return this.get("primary",...e)}secondary(...e){return this.get("secondary",...e)}tertiary(...e){return this.get("tertiary",...e)}transparent(...e){return this.get("transparent",...e)}light(...e){return this.get("light",...e)}}const B=new _("ui"),D=new _("text"),N=new _("motion"),P=new _("red"),L=new _("sound"),M=new _("control"),j=new _("data"),$=new _("pen"),U=new _("error"),F=new _("extensions"),V=new _("extensions"),G={ui:{primary:B.primary(),secondary:B.secondary(),tertiary:B.tertiary(),modalOverlay:B.get("modal","overlay"),white:B.get("white"),whiteDim:B.get("white","dim"),whiteTransparent:B.get("white","transparent"),transparent:B.transparent(),blackTransparent:B.get("black","transparent")},text:{primary:D.primary(),primaryTransparent:D.transparent()},motion:{primary:N.primary(),tertiary:N.tertiary(),transparent:N.get("transparent"),lightTansparent:N.light("transparent")},red:{primary:P.primary(),tertiary:P.tertiary()},sound:{primary:L.primary(),tertiary:L.tertiary()},control:{primary:M.primary()},data:{primary:j.primary()},pen:{primary:$.primary(),transparent:$.transparent()},error:{primary:U.primary(),light:U.light(),transparent:U.transparent()},extensions:{primary:F.primary(),tertiary:F.tertiary(),light:F.light(),transparent:F.transparent()},drop:{highlight:V.get("highlight")}},H=new RegExp("^[a-z0-9]+$","i"),z=new RegExp("[^a-z0-9]+","gi"),K=["prg","prg".split("").reverse().join("")],W=new RegExp(`${K[0]}([0-9]+)${K[1]}`,"g"),J=(e,t,r)=>e.replaceAll(t,r),q="customSaveDataPerExtension";function X(e){return class extends e{constructor(){super(...arguments),this.saveDataHandler=void 0}save(e,t){var r;const{saveDataHandler:n,id:o}=this,i=this.supports("customArguments")?this.customArgumentManager:null,a=null!==(r=null==n?void 0:n.hooks.onSave(this))&&void 0!==r?r:{};if(null==i||i.saveTo(a),0===Object.keys(a).length)return;const s=e[q];s?s[o]=a:e[q]={[o]:a},t.add(o)}load(e){if(!e)return;const{saveDataHandler:t,id:r}=this,n=q in e?e[q][r]:null;n&&(null==t||t.hooks.onLoad(this,n),this.supports("customArguments")&&this.customArgumentManager.loadFrom(n))}}}const Z=(e,t)=>{var n;switch(e){case r.String:return`${t}`;case r.Number:return parseFloat(t);case r.Boolean:return JSON.parse(null!=t&&t);case r.Note:case r.Angle:return parseInt(t);case r.Matrix:return Q(t);case r.Color:return"string"==typeof t&&"#"===t.substring(0,1)?null!==(n=x(t))&&void 0!==n?n:{r:0,g:0,b:0,a:255}:E(Z("number",t));default:throw new Error(`Method not implemented for value of ${t} and type ${e}`)}},Y=e=>1===parseInt(e),Q=e=>{if(25!==e.length)return new Array(5).fill(new Array(5).fill(!1));return e.split("").map(Y).reduce(((e,t,r)=>{const n=Math.floor(r/5);return 0===r%5?e[n]=[t]:e[n].push(t),e}),new Array(5))},ee=[],te=e=>JSON.stringify(e);class re{constructor(){this.valueLookup=new Map,this.idLookup=new Map,this.current=null}setCurrent(e){return this.current=e}setEntry(e){var t;return null!==(t=this.idLookup.get(te(e)))&&void 0!==t?t:this.add(e)}insert({id:e,entry:t},r){this.valueLookup.set(e,t),this.idLookup.set(null!=r?r:te(t),e),ee.push({text:t.text,value:e})}get entries(){return ee}add(e){const t=te(e),r=this.idLookup.get(t);if(r)return r;const n=re.GetIdentifier();return this.insert({id:n,entry:e},t),n}request(e,t){return this.setCurrent(e),e=>t(this.setCurrent(this.setEntry(e)))}getCurrent(){return{text:this.getEntry(this.current).text,value:this.current}}getEntry(e){return this.valueLookup.get(e)}requiresSave(){this.valueLookup.size}saveTo(e){const t=Array.from(this.valueLookup.entries()).filter((([e,t])=>null!==t)).map((([e,t])=>({id:e,entry:t})));0!==t.length&&(e[re.SaveKey]=t)}loadFrom(e){var t;null===(t=e[re.SaveKey])||void 0===t||t.forEach((e=>this.insert(e)))}purgeStaleIDs(){}}re.IsIdentifier=e=>e.startsWith(re.IdentifierPrefix),re.SaveKey="internal_customArgumentsSaveData",re.GetIdentifier=()=>re.IdentifierPrefix+T(),re.IdentifierPrefix="__customArg__";class ne{makeImage(){return new Image}makeCanvas(){return document.createElement("canvas")}resize(e,t,r){const n=this.makeCanvas();n.width=t,n.height=e.height;let o=n.getContext("2d");o.imageSmoothingEnabled=!1,o.drawImage(e,0,0,n.width,n.height);const i=this.makeCanvas();return i.width=t,i.height=r,o=i.getContext("2d"),o.imageSmoothingEnabled=!1,o.drawImage(n,0,0,i.width,i.height),i}convertResolution1Bitmap(e,t){const r=new Image;r.src=e,r.onload=()=>{t(null,this.resize(r,2*r.width,2*r.height).toDataURL())},r.onerror=()=>{t("Image load failed")}}getResizedWidthHeight(e,t){const r=480,n=360;if(e<=r&&t<=n)return{width:2*e,height:2*t};if(e<=960&&t<=720)return{width:e,height:t};const o=e/t;return o>=1.3333333333333333?{width:960,height:960/o}:{width:720*o,height:720}}importBitmap(e){return new Promise(((t,r)=>{const n=this.makeImage();n.src=e,n.onload=()=>{const r=this.getResizedWidthHeight(n.width,n.height);if(r.width===n.width&&r.height===n.height)t(this.convertDataURIToBinary(e));else{const e=this.resize(n,r.width,r.height).toDataURL();t(this.convertDataURIToBinary(e))}},n.onerror=()=>{r("Image load failed")}}))}convertDataURIToBinary(e){const t=";base64,",r=e.indexOf(t)+8,n=e.substring(r),o=window.atob(n),i=o.length,a=new Uint8Array(new ArrayBuffer(i));for(let e=0;e<i;e++)a[e]=o.charCodeAt(e);return a}}let oe,ie;const ae=e=>"renderer"in e,se="Costume could not be added as the supplied target wasn't a rendered target";const ce=[],le=(e,...t)=>{var r;return null===(r=ce.pop())||void 0===r||r(t),e};let ue;const de=(e,t)=>u(void 0,void 0,void 0,(function*(){const r=((e,t)=>{const r=e.getElementsByClassName(t);if(1!==r.length)throw new Error(`Uh oh! Expected 1 element with class '${t}', but found ${r.length}`);return r[0]})(document,"blocklyDropDownContent"),n=yield m((()=>r.children[0]));new e({target:r,anchor:n,props:t}),n.style.display="none"}));const me={isSimpleStatic:e=>Array.isArray(e),isSimpleDynamic:e=>h(e),isStaticWithReporters:e=>"items"in e,isDynamicWithReporters:e=>"getItems"in e},pe=e=>`${e}`,he=e=>g(e)?`${e}`:Object.assign(Object.assign({},e),{value:`${e.value}`}),ge=(e,t)=>({acceptReporters:t,items:e.map((e=>e)).map(he)}),ye=(e,t,r)=>t?e.menu=((e,t)=>{const r=t.indexOf(e),n=r>=0?r:t.push(e)-1;return`${pe(n)}`})(t,r):null,fe=(e,t,r)=>e,ve=e=>e.map((e=>{if(g(e))return y;if(e.type===r.Image)return y;const{options:t}=e;return(e=>e&&"handler"in e)(t)?t.handler:y})),be=e=>`${e}`,we=e=>g(e)?e:e.type,Ee=e=>{var t,r;const n="args";return"arg"in e&&e.arg?[e.arg]:n in e&&(null!==(r=null===(t=e[n])||void 0===t?void 0:t.length)&&void 0!==r?r:0)>0?e.args:[]},xe=(e,t,r,n)=>{void 0!==n&&(e.defaultValue=((e,t,r)=>p(e)?fe(e):e)(n))},ke=e=>!p(e)&&e.type===r.Image,Te=(e,t,r)=>{if(!r||0===r.length)return t;if(!(e=>!p(e))(t))return fe(t);const n=t,o=r.map(((e,t)=>`[${be(t)}]`));return fe(n(...o))},Oe=e=>`internal_${e}`,Se="ERROR: This argument represents an inline image and should not be accessed.",Ie=e=>{return void 0!==(null==(t=e)?void 0:t[C])?void 0:console.error("Block method was not given a block utility, and thus was likely called by something OTHER THAN the Scratch Runtime. NOTE: You cannot call block methods directly from within your class due to how block methods are converted to work with scratch. Consider abstracting the logic to a seperate, non-block method which can be invoked directly.");var t},Ce=(e,t,n)=>e.supports("customArguments")?function(o,i){Ie(i);const a=n.map((({name:t,type:n,handler:i})=>{if(n===r.Image)return Se;const a=o[t];if(n===r.Custom){const t=p(a)&&re.IsIdentifier(a)?this.customArgumentManager.getEntry(a).value:a;return i.call(e,t)}return Z(n,i.call(e,a))}));return t.call(e,...a,i)}:function(o,i){Ie(i);const a=n.map((({name:t,type:n,handler:i})=>n===r.Image?Se:Z(n,i.call(e,o[t]))));return t.call(e,...a,i)};function Re(e){return class extends e{constructor(){super(...arguments),this.blockMap=new Map,this.menus=[]}pushBlock(e,t,r){if(this.blockMap.has(e))throw new Error(`Attempt to push block with opcode ${e}, but it was already set. This is assumed to be a mistake.`);this.blockMap.set(e,{definition:t,operation:r})}getInfo(){if(!this.info){const{id:e,name:t,blockIconURI:r}=this,n=Array.from(this.blockMap.entries()).map((e=>this.convertToInfo(e))),o=this.blockColor,i=this.menuColor,a=this.menuSelectColor;this.info={id:e,blocks:n,name:t,blockIconURI:r,menus:this.collectMenus(),color1:o,color2:i,color3:a}}return this.info}convertToInfo(e){const[r,n]=e,{definition:o,operation:i}=n,a=(e=>h(e))(o)?v(o,this,this):o,{type:s,text:c}=a,l=Ee(a),{id:u,runtime:d,menus:m}=this,p=Te(0,c,l),y=((e,t,r)=>{if(t&&0!==t.length)return Object.fromEntries(t.map(((t,n)=>{if(ke(t))return Object.assign(Object.assign({},t),{dataURI:t.uri});const o={};if(o.type=we(t),g(t))return o;const{defaultValue:i,options:a}=t;return xe(o,e,n,i),ye(o,a,r),o})).reduce(((e,t,r)=>e.set(be(r),t)),new Map))})(r,l,m),f={opcode:r,text:p,blockType:s,arguments:y};if(s===t.Button){const e=((e,t)=>`${e}_${t}`)(u,r);A(d,e,i.bind(this)),f.func=e}else{this[Oe(r)]=Ce(this,i,((e,t)=>{const r=e.map(we),n=ve(e);return null!=t||(t=r.map(((e,t)=>be(t)))),w(r,n,t),r.map(((e,r)=>({type:e,name:t[r],handler:n[r]})))})(l))}return f}collectMenus(){const{isSimpleStatic:e,isSimpleDynamic:t,isStaticWithReporters:r,isDynamicWithReporters:n}=me;return Object.fromEntries(this.menus.map(((o,i)=>{if(e(o))return ge(o,!1);if(t(o))return this.registerDynamicMenu(o,!1,i);if(r(o))return ge(o.items,!0);if(n(o))return this.registerDynamicMenu(o.getItems,!0,i);throw new Error("Unable to process menu")})).reduce(((e,t,r)=>e.set(pe(r),t)),new Map))}registerDynamicMenu(e,t,r){const n=`internal_dynamic_${r}`;return this[n]=()=>e.call(this).map((e=>e)).map(he),{acceptReporters:t,items:n}}}}const Ae=k("blocks"),_e="__getter__",Be="__setter__";function De(e){return function(t,r){const n=t.name,o=Oe(n);r.addInitializer((function(){this.pushBlock(n,e,t)}));if(!h(e)){const{type:t}=e;null==Ae||Ae.fire({methodName:n,args:Ee(e).map((e=>p(e)?e:e.type)),returns:"command"===t?"void":"Boolean"===t?"bool":"any",scratchType:e.type})}return function(){return this[o].call(this,...arguments)}}}const Ne=e=>t=>r=>{const{operation:n,argumentMethods:o}=h(t)?t.call(r,r):t;return o&&Le(e,o,r),Object.assign(Object.assign({},e),{operation:n})},Pe=e=>(...t)=>{if(0===t.length||!t[0])return De(e);const r=t[0];return De((t=>{const{argumentMethods:n}=h(r)?r.call(t,t):r;return Le(e,n,t),e}))},Le=(e,t,r)=>{const n=e.args?e.args:e.arg?[e.arg]:[];Object.entries(t).map((([e,{handler:t,getItems:r}])=>({arg:n[parseInt(e)],methods:{handler:t,getItems:r}}))).forEach((({arg:e,methods:t})=>Object.entries(t).filter((([e,t])=>void 0!==t)).map((([e,t])=>[e,t.bind(r)])).forEach((([t,r])=>Me(e,t,r)))))},Me=(e,t,r)=>{h(e.options)&&(e.options=r),e.options[t]=r},je=e=>{if(p(e))throw new Error(`Block defined as string, unexpected! ${e}`);return e},$e=e=>Array.from(e.blocks.map(je).reduce(((t,r)=>((e,t,r)=>{const{opcode:n,arguments:o,blockType:i}=t,{text:a,orderedNames:c}=Ue(t);if(!o){if("string"!=typeof a)throw new Error(`Text is not a string: ${a}`);return e.set(n,{type:i,text:a})}const l=Object.entries(null!=o?o:{}).map((e=>{var[t,n]=e,{menu:o}=n,i=s(n,["menu"]);return Object.assign({options:He(r,o),name:t,menu:o},i)})).sort((({name:e},{name:t})=>c.indexOf(e)<c.indexOf(t)?-1:1)).map((e=>s(e,["name"]))),{length:u}=l;return u>=2?e.set(n,{type:i,text:a,args:l}):e.set(n,{type:i,text:a,arg:l[0]})})(t,r,e)),new Map).entries()),Ue=({arguments:e,text:t})=>{const r="Error: This should have been overridden by legacy support";if(!e)return{orderedNames:null,text:r};const n=Object.keys(e).map((e=>({name:e,template:`[${e}]`}))).sort((({template:e},{template:r})=>t.indexOf(e)<t.indexOf(r)?-1:1));return 0===n.length?{orderedNames:null,text:r}:{orderedNames:n.map((({name:e})=>e)),text:()=>r}},Fe={getItems:()=>"Error: This should have been filled in."},Ve={handler:()=>"Error: This should have been filled in."},Ge=e=>p(e),He=(e,t)=>{const r=t?e.menus[t]:void 0;if(!r)return;if(Ge(r))return Fe.getItems;const{items:n,acceptReporters:o}=r;return Ge(n)?o?Object.assign(Object.assign({acceptsReporters:o},Ve),Fe):Fe.getItems:o?Object.assign({acceptsReporters:o,items:[...n]},Ve):[...n]},ze=(e,t)=>{if(p(e))throw new Error("Block was unexpectedly a string: "+e);return!!t.has(e.opcode)||(console.error(`Could not find legacy opcode ${e.opcode} within currently defined blocks`),!1)},Ke=e=>{if(typeof e.legacy.menu!=typeof e.modern.menu)throw new Error("Menus don't match");return e},We=e=>{if(Ge(e))return e;if(Ge(e.items))return e.items;throw new Error("Menu is not dynamic: "+e)};function Je(e){return class extends e{constructor(){super(...arguments),this.__isLegacy=!0,this.orderArgumentNamesByBlock=new Map,this.getArgNames=e=>{const{opcode:t}=e;if(!this.orderArgumentNamesByBlock.has(t)){const{orderedNames:r}=Ue(e);this.orderArgumentNamesByBlock.set(t,r)}return this.orderArgumentNamesByBlock.get(t)}}getInfo(){if(!this.validatedInfo){const e=super.getInfo();this.validatedInfo=this.validateAndAttach(e)}return this.validatedInfo}validateAndAttach(e){var{id:t,blocks:r,menus:n}=e,o=s(e,["id","blocks","menus"]);const{id:i,blocks:a,menus:c}=this.getLegacyInfo(),l=[...r];if(t!==i)throw new Error(`ID mismatch! Legacy id: ${i} vs. current id: ${t}`);const u=l.reduce(((e,t,r)=>{var{opcode:n}=t,o=s(t,["opcode"]);return e.set(n,Object.assign(Object.assign({},o),{index:r}))}),new Map),d=this,m=a.map((e=>ze(e,u)?e:void 0)).filter(Boolean).map((e=>{const{opcode:t,arguments:r}=e,{index:o,arguments:i}=u.get(t),a=this.getArgNames(e);if(!a)return{replaceAt:{index:o,block:e}};const s=this[Oe(t)];this[t]=((...[e,t])=>s.call(d,(e=>a.reduce(((t,r,n)=>b(t,n,e[r])),{}))(e),t)).bind(d);const l=a.map(((e,t)=>({legacy:r[e],modern:i[t]}))).map(Ke).map((({legacy:{menu:e},modern:{menu:t}})=>({legacyName:e,modernName:t}))).filter((e=>e.legacyName&&e.modernName)).map((({legacyName:e,modernName:t})=>({legacyName:e,modernName:t,legacy:c[e],modern:n[t]}))).map((({legacy:e,modern:t,legacyName:r,modernName:n})=>Ge(e)||Ge(e.items)?{type:"dynamic",legacy:r,modern:n,methods:{legacy:We(e),modern:We(t)}}:{type:"static",legacy:r,modern:n}));return{menuUpdates:l,replaceAt:{index:o,block:e}}}));return m.forEach((({replaceAt:{index:e,block:t}})=>{const r=l[e];l[e]=t,"button"===t.blockType&&(l[e].func=r.func)})),m.map((({menuUpdates:e})=>e)).flat().filter(Boolean).map((e=>{const{legacy:t}=e;if(t in n)throw new Error(`Somehow, there was already a menu called ${t}, which will cause issues in the next step.`);return e})).forEach((({type:e,legacy:t,methods:r})=>{n[t]=c[t],"dynamic"===e&&(d[r.legacy]=()=>d[r.modern]())})),Object.assign({id:t,blocks:l,menus:n},o)}}}const qe=e=>"text"===e.nodeName,Xe={success:"#5ACA75",warning:"#FF8f39",error:"#db1f1f"},Ze={fill:"white","font-weight":"bold","font-size":"14pt","font-family":'"Helvetica Neue", Helvetica, Arial, sans-serif;'};const Ye=(e,t)=>{for(const r in t)e.setAttribute(r,`${t[r]}`)},Qe=()=>[et("rect"),et("polygon"),et("text")],et=e=>document.createElementNS("http://www.w3.org/2000/svg",e),tt=(()=>{const e=5,t=14,r=10,n=26;return[[50,15],[100,100],[0,100]].map((([o,i])=>[o/e+r,i/t+n])).map((([e,t])=>`${e} ${t}`)).join(", ")})();const rt=e=>{const t=document.body.getElementsByClassName("blocklyFlyout");if(1!==t.length)return{error:"No top level element found."};for(const r of t[0].getElementsByClassName("blocklyFlyoutLabel categoryLabel"))for(const t of r.getElementsByClassName("blocklyFlyoutLabelText"))if(t.innerHTML===e&&"g"===r.nodeName&&qe(t))return{container:r,title:t};return{error:"No title found matching given name"}},nt={image:"image-data",canvas:"canvas"};function ot(e){return class extends e{constructor(){super(...arguments),this.videoDimensions={width:480,height:360}}get video(){var e,t;return null!==(e=this.videoDevice)&&void 0!==e||(this.videoDevice=null===(t=this.runtime.ioDevices)||void 0===t?void 0:t.video),this.videoDevice}getVideoFrame(e){var t;return null===(t=this.video)||void 0===t?void 0:t.getFrame({format:nt[e]})}setVideoTransparency(e){var t;null===(t=this.video)||void 0===t||t.setPreviewGhost(e)}enableVideo(e=!0){this.video&&(this.video.enableVideo(),this.video.provider.mirror=e)}disableVideo(){var e;null===(e=this.video)||void 0===e||e.disableVideo()}}}const it={customArguments:function(e){class t extends(le(e,X)){constructor(){super(...arguments),this.argumentManager=null,this.makeCustomArgument=({component:e,initial:t,acceptReportersHandler:n})=>{const o=this.customArgumentManager.add(t),i=()=>this.processMenuForCustomArgument(o,e);return{type:r.Custom,defaultValue:o,options:void 0===n?i:{acceptsReports:!0,getItems:i,handler:n}}}}get customArgumentManager(){var e;return null!==(e=this.argumentManager)&&void 0!==e||(this.argumentManager=new re),this.argumentManager}processMenuForCustomArgument(e,t){var r;const{runtime:n,argumentManager:o}=this,i=n[I.runtimeKey],{state:a,update:s,entry:c}=i;switch(a){case"init":case"close":return o.entries;case"open":const n=null!==(r=null==c?void 0:c.value)&&void 0!==r?r:e,i=o.getEntry(n),a=o.request(n,s);return de(t,{setter:a,current:i,extension:this}),[{text:i.text,value:n}];case"update":return[o.getCurrent()]}}}return t},ui:function(e){return class extends e{openUI(e,t){const{id:r,name:n,runtime:o}=this;R(o,{id:r,name:n,component:e.replace(".svelte",""),label:t})}}},customSaveData:X,video:ot,drawable:function(e){return class extends e{createDrawable(e){var t;null!==(t=this.renderer)&&void 0!==t||(this.renderer=this.runtime.renderer);const{renderer:r}=this;if(!r)return null;const o=r.createBitmapSkin(e,1),i=r.createDrawable(n.VideoLayer);r.updateDrawableSkinId(i,o);const a=e=>r.updateDrawableEffect(i,"ghost",e),s=(e=!0)=>r.updateDrawableVisible(i,e);return a(0),s(!0),{setTransparency:a,setVisible:s,update:e=>r.updateBitmapSkin(o,e,1),destroy:()=>{s(!1),r.destroyDrawable(i,n.VideoLayer),r.destroySkin(o)}}}}},addCostumes:function(e){return class extends e{addCostume(e,t,r,n){return u(this,void 0,void 0,(function*(){null!=ie||(ie=(e=>{const t=document.body.appendChild(document.createElement("canvas")),r=({width:e,height:r})=>{t.width!==e&&(t.width=e),t.height!==r&&(t.height=r)};r(e),t.hidden=!0;const n=t.getContext("2d");return{getDataURL(e){const{width:o,height:i}=e;r(e),n.save(),n.clearRect(0,0,o,i),n.putImageData(e,0,0);const a=t.toDataURL("image/png");return n.restore(),a}}})(t)),yield this.addCostumeBitmap(e,ie.getDataURL(t),r,n)}))}addCostumeBitmap(e,t,r,n){return u(this,void 0,void 0,(function*(){if(!ae(e))return console.error(se);null!=n||(n=`${this.id}_generated_${Date.now()}`),null!=oe||(oe=new ne);const{storage:o}=this.runtime,i=o.DataFormat.PNG,a=o.AssetType.ImageBitmap,s=yield oe.importBitmap(t),c=o.createAsset(a,i,s,null,!0),{assetId:l}=c,u={name:n,dataFormat:i,asset:c,md5:`${l}.${i}`,assetId:l};yield this.runtime.addCostume(u);const{length:d}=e.getCostumes();e.addCostume(u,d),"add and set"===r&&e.setCostume(d)}))}setCostumeByName(e,t){if(!ae(e))return console.error(se),!1;let r=e.getCostumeIndexByName(t);return!(r<0)&&(e.setCostume(r),!0)}}},legacySupport:Je,setTransparencyBlock:function(e){let t=(()=>{var t;let r,n=le(e,ot),o=[];return t=class extends n{setVideoTransparencyBlock(e){this.setVideoTransparency(e)}constructor(){super(...arguments),l(this,o)}},(()=>{var e;const i="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(e=n[Symbol.metadata])&&void 0!==e?e:null):void 0;r=[De({type:"command",text:e=>`Set video to ${e}% transparent`,arg:"number"})],c(t,0,r,{kind:"method",name:"setVideoTransparencyBlock",static:!1,private:!1,access:{has:e=>"setVideoTransparencyBlock"in e,get:e=>e.setVideoTransparencyBlock},metadata:i},null,o),i&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:i})})(),t})();return t},toggleVideoBlock:function(e){let t=(()=>{var t;let r,n=le(e,ot),o=[];return t=class extends n{toggleVideoBlock(e){if("off"===e)return this.disableVideo();this.enableVideo("on"===e)}constructor(){super(...arguments),l(this,o)}},(()=>{var e;const i="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(e=n[Symbol.metadata])&&void 0!==e?e:null):void 0;r=[De({type:"command",text:e=>`Set video feed to ${e}`,arg:{type:"string",options:["on","off","on (flipped)"]}})],c(t,0,r,{kind:"method",name:"toggleVideoBlock",static:!1,private:!1,access:{has:e=>"toggleVideoBlock"in e,get:e=>e.toggleVideoBlock},metadata:i},null,o),i&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:i})})(),t})();return t},appInventor:function(e){return class extends e{get withinAppInventor(){return!1}}},indicators:function(e){return class extends e{indicate(e){return u(this,arguments,void 0,(function*({position:e="category",msg:t,type:r="success"}){const n="category"===e?rt(this.name):{error:"Unsupported indicator position"};if("error"in n)throw new Error(n.error);const{container:o}=n,i=yield function(e,t,r){return u(this,void 0,void 0,(function*(){const n=Qe(),[o,i,a]=n,s=Xe[r];Ye(i,{points:tt,fill:s}),Ye(a,{x:6,y:55}),Ye(a,Ze),a.innerHTML=t,n.forEach((t=>e.appendChild(t))),yield Promise.resolve();const{width:c,height:l}=a.getBBox();return Ye(o,{x:0,width:c+12,height:l+12,y:55-l,fill:s,rx:5}),{close(){n.forEach((t=>e.removeChild(t)))}}}))}(o,t,r);return i}))}indicateFor(e,t){return u(this,arguments,void 0,(function*({position:e="category",msg:t,type:r="success"},n){const{close:o}=yield this.indicate({position:e,msg:t,type:r});yield d(1e3*n),o()}))}}}};class at{internal_init(){return u(this,void 0,void 0,(function*(){const e=this.runtime;return yield Promise.resolve(this.init({runtime:e,get extensionManager(){return e.getExtensionManager()}}))}))}constructor(e,t,r,n,o,i,a){this.runtime=e,this.name=t,this.id=r,this.blockIconURI=n,this.blockColor=o,this.menuColor=i,this.menuSelectColor=a}}const st=new Map;class ct extends at{constructor(e){super(...arguments),st.set(this.id,this)}}function lt(e,t){return class extends e{supports(e){return t.includes(e)}}}const ut=k("extension"),dt=(e,...t)=>{e&&(null==ut||ut.fire({details:e,addOns:t}));const r=(n=Re(lt(ct,t)),class extends n{pushVersions(e,t){}});var n;if(!t)return r;const{Result:o,allSupported:i}=mt(r,t);return lt(o,Array.from(i))},mt=(e,t,r=new Set)=>{const n=t.filter((e=>!r.has(e))).map((e=>(r.add(e),e))).map((e=>it[e])).reduce(((e,t)=>{const{dependencies:n,MixedIn:o}=(e=>{let t;null!=ue||(ue=Object.entries(it).reduce(((e,[t,r])=>e.set(r,t)),new Map)),ce.push((e=>{e.map((e=>e)).forEach((e=>{if(!ue.has(e))throw new Error("Unkown mixin dependency! "+e);null!=t||(t=[]),t.push(ue.get(e))}))}));const r=e();return{dependencies:t,MixedIn:r}})((()=>t(e)));return n?mt(o,n,r).Result:o}),e);return{Result:n,allSupported:r}};class pt extends(dt(void 0,"ui","customSaveData","customArguments")){internal_init(){const e=Object.create(null,{internal_init:{get:()=>super.internal_init}});return u(this,void 0,void 0,(function*(){yield e.internal_init.call(this);const t=this.defineBlocks(),r=this;for(const e in t){this.validateOpcode(e);const n=t[e],{operation:o,text:i,arg:a,args:s,type:c}=h(n)?n.call(this,this):n;this.pushBlock(e,a?{text:i,type:c,arg:a}:s?{text:i,type:c,args:s}:{text:i,type:c},o);const l=Oe(e);this[e]=function(){return r[l].call(r,...arguments)}}}))}validateOpcode(e){if(!(e in this))return;throw new Error(`The Extension has a member defined as '${e}', but that name should be reserved for the opcode of the block with the same name. Please rename your member, and attach the "validateGenericExtension" decorator to your class so that this can be an error in your IDE and not at runtime.`)}}const ht=(e,t,...r)=>{if(0===r.length)return{type:e,text:t[0]};const n=(...e)=>t.map(((t,r)=>{var n;return`${t}${null!==(n=e[r])&&void 0!==n?n:""}`})).join("");return 1===r.length?{type:e,text:n,arg:r[0]}:{type:e,text:n,args:r}};function gt(e){return function(t,...r){return function(n,o){return De("function"==typeof t?r=>t.call(r,r,ht.bind(null,e)):ht(e,t,...r))(n,o)}}}const yt={reporter:gt("reporter"),command:gt("command"),button:gt("button")};return e.ArgumentType=r,e.AuxiliaryExtensionInfo="AuxiliaryExtensionInfo",e.BlockType=t,e.Branch={Exit:0,Enter:1,First:1,Second:2,Third:3,Fourth:4,Fifth:5,Sixth:6,Seventh:7},e.ConstructableExtension=at,e.CustomArgumentManager=re,e.Extension=pt,e.ExtensionBase=ct,e.FrameworkID="ExtensionFramework",e.Language=i,e.LanguageKeys=a,e.LayerGroups=o,e.RuntimeEvent={ScriptGlowOn:"SCRIPT_GLOW_ON",ScriptGlowOff:"SCRIPT_GLOW_OFF",BlockGlowOn:"BLOCK_GLOW_ON",BlockGlowOff:"BLOCK_GLOW_OFF",HasCloudDataUpdate:"HAS_CLOUD_DATA_UPDATE",TurboModeOn:"TURBO_MODE_ON",TurboModeOff:"TURBO_MODE_OFF",RecordingOn:"RECORDING_ON",RecordingOff:"RECORDING_OFF",ProjectStart:"PROJECT_START",ProjectRunStart:"PROJECT_RUN_START",ProjectRunStop:"PROJECT_RUN_STOP",ProjectStopAll:"PROJECT_STOP_ALL",StopForTarget:"STOP_FOR_TARGET",VisualReport:"VISUAL_REPORT",ProjectLoaded:"PROJECT_LOADED",ProjectChanged:"PROJECT_CHANGED",ToolboxExtensionsNeedUpdate:"TOOLBOX_EXTENSIONS_NEED_UPDATE",TargetsUpdate:"TARGETS_UPDATE",MonitorsUpdate:"MONITORS_UPDATE",BlockDragUpdate:"BLOCK_DRAG_UPDATE",BlockDragEnd:"BLOCK_DRAG_END",ExtensionAdded:"EXTENSION_ADDED",ExtensionFieldAdded:"EXTENSION_FIELD_ADDED",PeripheralListUpdate:"PERIPHERAL_LIST_UPDATE",PeripheralConnected:"PERIPHERAL_CONNECTED",PeripheralDisconnected:"PERIPHERAL_DISCONNECTED",PeripheralRequestError:"PERIPHERAL_REQUEST_ERROR",PeripheralConnectionLostError:"PERIPHERAL_CONNECTION_LOST_ERROR",PeripheralScanTimeout:"PERIPHERAL_SCAN_TIMEOUT",MicListening:"MIC_LISTENING",BlocksInfoUpdate:"BLOCKSINFO_UPDATE",RuntimeStarted:"RUNTIME_STARTED",RuntimeDisposed:"RUNTIME_DISPOSED",BlocksNeedUpdate:"BLOCKS_NEED_UPDATE",TargetWasCreated:"targetWasCreated",Say:"SAY"},e.SaveDataHandler=class{constructor(e){this.hooks=e}},e.ScratchBlocksConstants={OutputShapeHexagonal:1,OutputShapeRound:2,OutputShapeSquare:3},e.StageLayering=n,e.TargetType={Sprite:"sprite",Stage:"stage"},e.VariableType={Scalar:"",List:"list",BrooadcastMessage:"broadcast_msg"},e.activeClass=!0,e.assertSameLength=w,e.block=De,e.blockBundleEvent=Ae,e.blockIDKey=C,e.buttonBlock=function(e){return De({text:e,type:t.Button})},e.castToType=Z,e.color=G,e.copyTo=({target:e,source:t})=>{for(const r in t)r in e&&(e[r]=t[r])},e.decimalToRgb=E,e.decode=e=>[...[...e.matchAll(W)].reduce(((e,t)=>{const[r,n]=t;return e.set(r,String.fromCharCode(n))}),new Map)].reduce(((e,[t,r])=>J(e,t,r)),`${e}`),e.encode=e=>{const t=[...e.matchAll(z)].reduce(((e,t)=>(t[0].split("").forEach((t=>e.add(t))),e)),new Set);return[...t].map((e=>({char:e,code:e.charCodeAt(0)}))).reduce(((e,{char:t,code:r})=>J(e,t,`${K[0]}${r}${K[1]}`)),`${e}`)},e.extension=dt,e.extensionBundleEvent=ut,e.extensionsMap=st,e.fetchWithTimeout=function(e,t){return u(this,void 0,void 0,(function*(){const{timeoutMs:r}=t,n=new AbortController,o=setTimeout((()=>n.abort()),r),i=yield fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(o),i}))},e.getAccessorPrefix=_e,e.getTextFromMenuItem=e=>"object"==typeof e?e.text:e,e.getValueFromMenuItem=e=>"object"==typeof e?e.value:e,e.getterBlock=function(e){return function(t,r){const n=t.name.replace("get ",_e),o=Oe(n);r.addInitializer((function(){this[n]=(e,t)=>this[o].call(this,null,t);const r=`Get ${e.name}`;this.pushBlock(n,{type:"reporter",text:r},t)})),null==Ae||Ae.fire({methodName:n,args:[],returns:e.type,scratchType:"reporter"})}},e.guiDropdownInterop=I,e.hexToRgb=x,e.identity=y,e.isDynamicMenu=Ge,e.isFunction=h,e.isPrimitive=g,e.isString=p,e.isValidID=e=>H.test(e),e.legacy=(e,t)=>({for(){const t=$e(e).map((([e,t])=>({key:e,definer:Ne(t),decorator:Pe(t)}))),r=t.reduce(((e,{key:t,definer:r})=>(e[t]=r,e)),{}),n=t.reduce(((e,{key:t,decorator:r})=>(e[t]=r,e)),{}),o=()=>{throw new Error("This property is not meant to be accessed, and is instead solely for type inference / documentation purposes.")};return{legacyExtension:()=>(t,r)=>{class n extends(function(e,t){class r extends(Je(e)){getLegacyInfo(){return t}}return r}(t,e)){constructor(){super(...arguments),this.originalClassName=r.name}}return n},legacyDefinition:r,legacyBlock:n,ReservedNames:{get Menus(){return o()},get Blocks(){return o()},get ArgumentNamesByBlock(){return o()}}}}}),e.loadExternalScript=(e,t,r)=>{const n=document.createElement("script");n.onload=t,n.onerror=null!=r?r:()=>{throw new Error(`Error loading endpoint: ${e}`)},n.src=e,n.async=!0,document.body.appendChild(n)},e.makeDecorator=gt,e.openUI=R,e.openUIEvent=O,e.parseText=Ue,e.px=e=>`${e}px`,e.reactiveInvoke=(e,t,r)=>e[t](...r),e.reactiveSet=(e,t,r)=>{e[t]=r},e.registerButtonCallback=A,e.registerButtonCallbackEvent=S,e.rgbToHex=e=>(e=>{e<0&&(e+=16777216);let t=Number(e).toString(16);return t=`#${"000000".substr(0,6-t.length)}${t}`,t})(function(e){return(e.r<<16)+(e.g<<8)+e.b}(e)),e.saveDataKey=q,e.scratch=yt,e.set=b,e.setAccessorPrefix=Be,e.setterBlock=function(e){return function(r,n){const o=r.name.replace("set ",Be),i=Oe(o);n.addInitializer((function(){this[o]=(e,t)=>this[i].call(this,e,t);const n=e.type,a={type:t.Command,text:t=>`Set ${e.name} to ${t}`,arg:n};this.pushBlock(o,a,r)})),null==Ae||Ae.fire({methodName:o,args:[e.type],returns:"void",scratchType:"command"})}},e.splitOnCapitals=e=>e.split(/(?=[A-Z])/),e.tryCastToArgumentType=(e,t,r)=>{try{return Z(e,t)}catch(e){return r(t)}},e.tryCreateBundleTimeEvent=k,e.typesafeCall=v,e.untilCondition=function(e){return u(this,arguments,void 0,(function*(e,t=100){let r;for(;!e();)yield new Promise((e=>{clearTimeout(r),r=setTimeout(e,t)}));clearTimeout(r)}))},e.untilExternalGlobalVariableLoaded=(e,t)=>u(void 0,void 0,void 0,(function*(){return window[t]||(yield f(e)),window[t]})),e.untilExternalScriptLoaded=f,e.untilObject=m,e.untilReady=function(e){return u(this,arguments,void 0,(function*(e,t=100){let r;for(;!e.ready;)yield new Promise((e=>{clearTimeout(r),r=setTimeout(e,t)}));clearTimeout(r)}))},e.untilTimePassed=d,e.uuidv4=T,e.validGenericExtension=(...e)=>function(e,t){},e.wrapClamp=(e,t,r)=>{const n=r-t+1;return e-Math.floor((e-t)/n)*n},e}({});//# sourceMappingURL=ExtensionFramework.js.map
